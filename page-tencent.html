<script type="text/javascript">
$(function() {
    $('#menu-tencent').addClass('active');
});
</script>
<div class="container" id="content-wrap">
    <div class="page-post">
        <h2 class="blog-post-title">{{post.title}}</h2>
        <hr />
        <div class="page-content content-responsive">
            {{ post.content }}
        </div>
    </div>
</div>
<div class="container" id="content-wrap">
    <form class="needs-validation" novalidate method="post" id="form">
        <div class="form-group">
            <label for="name">姓名（请填写真实姓名）</label>
            <input type="text" class="form-control" id="name" placeholder="张三" required>
        </div>
        <div class="form-group">
            <label for="email">邮箱（内推成功后会收到收集信息的邮件，非常重要）</label>
            <input type="email" class="form-control" id="email" placeholder="tencent@gmail.com" required>
        </div>
        <div class="form-group">
            <label for="phone">手机（7 * 24 在线）</label>
            <input type="text" class="form-control" id="phone" placeholder="11位手机号" required>
            <div class="invalid-tooltip">
                请输入正确的手机号
            </div>
        </div>
        <div class="form-group">
            <label for="school">学校（学校全称）</label>
            <input type="text" class="form-control" id="school" placeholder="大连理工大学" required>
        </div>
        <div class="form-group">
            <label for="major">专业（专业大类）</label>
            <input type="text" class="form-control" id="major" placeholder="软件工程" required>
        </div>
        <div class="form-group">
            <div class="form-check">
                <input type="checkbox" class="form-check-input" id="agreement" required>
                <label class="form-check-label" for="agreement"><a href="tencent_agreement.html">同意内推协议</a></label>
                <div class="invalid-feedback">
                    请先同意内推协议
                </div>
            </div>
        </div>
        <div class="row">
            <div class="form-group col">
                <input type="text" class="form-control" id="verify-code" value="000000" placeholder="请输入接收到的验证码">
            </div>
            <div class="col">
                <button type="button" class="btn btn-primary" id="send-sms-code-btn">发送验证码</button>
            </div>
        </div>
        <div>
            <button type="submit" class="btn btn-primary">立即提交</button>
        </div>
    </form>
    <!-- Modal -->
    <div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">内推成功</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    内推信息已提交成功，请留意邮件和短信通知。
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="confirm-commit-btn">知道了</button>
                </div>
            </div>
        </div>
    </div>
    <script>
    $(document).ready(function() {
        $('#confirm-commit-btn').click(function(event) {
            $('#modal').modal('hide');
            window.location.href = "https://wxdut.com"
        });
        $('#send-sms-code-btn').click(function(event) {
            if (!check_form()) {
                return;
            }
            $('#phone').prop('disabled', true);
            sms_code_countdown();

            $.ajax({
                url: 'https://wxdut.com/index.php/tencent/sendSmsCode',
                type: "GET",
                data: { "phone": $.trim($('#phone').val()) },
                success: function(data) {
                    if (data.ret == 0) {
                        alert("验证码发送成功");
                    } else {
                        alert("验证码发送失败，请重试");
                    }
                }
            })
        });
    });
    (function() {
        'use strict';
        $('form').submit(function(event) {
            if (!check_form()) {
                return false;
            }
            if (!check_verify_code()) {
                alert("请输入六位数字验证码");
                return false;
            }

            $.ajax({
                url: 'https://wxdut.com/index.php/tencent/verifySmsCode',
                type: 'GET',
                data: { "phone": $.trim($('#phone').val()), "code": $.trim($('#verify-code').val()), "name": $.trim($('#name').val()), "email": $.trim($('#email').val()), "school": $.trim($('#school').val()), "major": $.trim($('#major').val()) },
                success: function(data) {
                    if (data.ret == 0) {
                        $('#modal').modal('show');
                    } else {
                        alert("验证码错误，请重试");
                    }
                }
            })
            return false;
        });
    })();

    function check_form() {
        if (!check_name()) {
            alert("请输入正确的姓名");
            return false;
        }
        if (!check_email()) {
            alert("请输入正确的邮箱");
            return false;
        }
        if (!check_phone()) {
            alert("请输入正确的手机号");
            return false;
        }
        if (!check_school()) {
            alert("请输入正确的学校");
            return false;
        }
        if (!check_major()) {
            alert("请输入正确的专业");
            return false;
        }
        if (!check_agreement()) {
            alert("请阅读并同意内推协议");
            return false;
        }
        return true;
    }

    function check_phone() {
        return /^1[34578]\d{9}$/.test($.trim($('#phone').val()));
    }

    function check_name() {
        return /^[\u4E00-\u9FA5]{1,6}$/.test($.trim($('#name').val()));
    }

    function check_email() {
        var reg = /^([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
        return $.trim($('#email').val()).match(reg);
    }

    function check_school() {
        return $.trim($('#school').val()).length != 0;
    }

    function check_major() {
        return $.trim($('#major').val()).length != 0;
    }

    function check_agreement() {
        return $('#agreement').prop('checked');
    }

    function check_verify_code() {
        return /^[0-9]{6}$/.test($.trim($('#verify-code').val()))
    }

    function sms_code_countdown() {
        var second = 60;
        var timer = setInterval(function() {
            second -= 1;
            if (second > 0) {
                $('#send-sms-code-btn').prop('disabled', true);
                $('#send-sms-code-btn').text(second + "秒后重新发送");
            } else {
                clearInterval(timer);
                $('#send-sms-code-btn').text("发送验证码");
                $('#send-sms-code-btn').prop('disabled', false);
            }
        }, 1000);
    }
    </script>
    <script src="asset/js/tencent.js"></script>
</div>